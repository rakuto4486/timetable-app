{% extends 'base.html' %}
{% block content %}
<h2 class="mb-3">大学時間割 & 成績管理アプリ</h2>

<hr>

<h3 class="mb-3">📝 やることリスト</h3>

<form method="post" class="row g-2 mb-4">
    <div class="col-12 col-md-4">
        <input type="text" name="task" class="form-control" placeholder="例: レポート提出" required>
    </div>
    <div class="col-12 col-md-4">
        <input type="text" name="class_name" class="form-control" placeholder="授業名（任意）">
    </div>
    <div class="col-12 col-md-3">
        <input type="date" name="due_date" class="form-control">
    </div>
    <div class="col-12 col-md-1 d-grid">
        <button type="submit" class="btn btn-primary">追加</button>
    </div>
</form>

<ul class="list-group mb-4">
    {% for todo in todos %}
    <li class="list-group-item d-flex justify-content-between align-items-start flex-wrap">
        <div>
            {% if todo.done %}
                ✅ <s>{{ todo.task }}</s>
            {% else %}
                {{ todo.task }}
            {% endif %}
            {% if todo.due_date %}
                <div class="text-muted small">期限: {{ todo.due_date }}（残り{{ todo.days_left }}日）</div>
            {% endif %}
            {% if todo.class_name %}
                <div class="text-muted small">授業: {{ todo.class_name }}</div>
            {% endif %}
        </div>
        <div>
            <a href="{{ url_for('mark_done', index=loop.index0) }}" class="btn btn-sm btn-outline-success me-2">
                {% if todo.done %}戻す{% else %}完了{% endif %}
            </a>
            <a href="{{ url_for('delete_todo', index=loop.index0) }}" class="btn btn-sm btn-outline-danger">削除</a>
        </div>
    </li>
    {% endfor %}
</ul>

<hr>

<h3 class="mb-3">📅 今日の授業とToDo</h3>

{% if today_schedule %}
    {% for subject in today_schedule %}
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">{{ subject.class_name }}</h5>
                <p class="card-text">
                    {{ subject.day }}曜 {{ subject.period }}限<br>
                    {{ subject.room }} / {{ subject.teacher }}
                </p>
                {% for block in today_todos %}
                    {% if block.class_name == subject.class_name %}
                        <ul class="mb-0">
                        {% for task in block.tasks %}
                            <li>{{ task.task }}（あと {{ task.days_left }}日）</li>
                        {% endfor %}
                        </ul>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    {% endfor %}
{% else %}
    <p>今日の授業はありません。</p>
{% endif %}

{% endblock %}
