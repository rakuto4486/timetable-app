{% extends 'base.html' %}
{% block content %}
<h2 class="mb-3">å¤§å­¦æ™‚é–“å‰² & æˆç¸¾ç®¡ç†ã‚¢ãƒ—ãƒª</h2>

<hr>

<h3 class="mb-3">ğŸ“ ã‚„ã‚‹ã“ã¨ãƒªã‚¹ãƒˆ</h3>

<form method="post" class="row g-2 mb-4">
    <div class="col-12 col-md-4">
        <input type="text" name="task" class="form-control" placeholder="ä¾‹: ãƒ¬ãƒãƒ¼ãƒˆæå‡º" required>
    </div>
    <div class="col-12 col-md-4">
        <input type="text" name="class_name" class="form-control" placeholder="æˆæ¥­åï¼ˆä»»æ„ï¼‰">
    </div>
    <div class="col-12 col-md-3">
        <input type="date" name="due_date" class="form-control">
    </div>
    <div class="col-12 col-md-1 d-grid">
        <button type="submit" class="btn btn-primary">è¿½åŠ </button>
    </div>
</form>

<ul class="list-group mb-4">
    {% for todo in todos %}
    <li class="list-group-item d-flex justify-content-between align-items-start flex-wrap">
        <div>
            {% if todo.done %}
                âœ… <s>{{ todo.task }}</s>
            {% else %}
                {{ todo.task }}
            {% endif %}
            {% if todo.due_date %}
                <div class="text-muted small">æœŸé™: {{ todo.due_date }}ï¼ˆæ®‹ã‚Š{{ todo.days_left }}æ—¥ï¼‰</div>
            {% endif %}
            {% if todo.class_name %}
                <div class="text-muted small">æˆæ¥­: {{ todo.class_name }}</div>
            {% endif %}
        </div>
        <div>
            <a href="{{ url_for('mark_done', index=loop.index0) }}" class="btn btn-sm btn-outline-success me-2">
                {% if todo.done %}æˆ»ã™{% else %}å®Œäº†{% endif %}
            </a>
            <a href="{{ url_for('delete_todo', index=loop.index0) }}" class="btn btn-sm btn-outline-danger">å‰Šé™¤</a>
        </div>
    </li>
    {% endfor %}
</ul>

<hr>

<h3 class="mb-3">ğŸ“… ä»Šæ—¥ã®æˆæ¥­ã¨ToDo</h3>

{% if today_schedule %}
    {% for subject in today_schedule %}
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">{{ subject.class_name }}</h5>
                <p class="card-text">
                    {{ subject.day }}æ›œ {{ subject.period }}é™<br>
                    {{ subject.room }} / {{ subject.teacher }}
                </p>
                {% for block in today_todos %}
                    {% if block.class_name == subject.class_name %}
                        <ul class="mb-0">
                        {% for task in block.tasks %}
                            <li>{{ task.task }}ï¼ˆã‚ã¨ {{ task.days_left }}æ—¥ï¼‰</li>
                        {% endfor %}
                        </ul>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    {% endfor %}
{% else %}
    <p>ä»Šæ—¥ã®æˆæ¥­ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
{% endif %}

{% endblock %}
