{% extends 'base.html' %}
{% block content %}
<div class="container mt-4" style="max-width: 700px;">
  <h2 class="mb-4">ğŸ“ å¤§å­¦æ™‚é–“å‰² & æˆç¸¾ç®¡ç†ã‚¢ãƒ—ãƒª</h2>

  <h4 class="mt-4">ğŸ“ ã‚„ã‚‹ã“ã¨è¿½åŠ </h4>
  <form method="post" class="row g-2 mb-4">
    <div class="col-12">
      <input type="text" name="task" placeholder="ä¾‹: ãƒ¬ãƒãƒ¼ãƒˆæå‡º" class="form-control" required>
    </div>
    <div class="col-md-6">
      <input type="text" name="class_name" placeholder="æˆæ¥­åï¼ˆä»»æ„ï¼‰" class="form-control">
    </div>
    <div class="col-md-6">
      <input type="date" name="due_date" class="form-control">
    </div>
    <div class="col-12 d-grid">
      <button type="submit" class="btn btn-primary">è¿½åŠ </button>
    </div>
  </form>

  <h4 class="mt-4">ğŸ“… ä»Šæ—¥ã®æˆæ¥­ã¨ToDo</h4>
  {% if today_schedule %}
    {% for subject in today_schedule %}
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">{{ subject.class_name }}ï¼ˆ{{ subject.day }}æ›œãƒ»{{ subject.period }}é™ï¼‰</h5>
          <p class="card-text text-muted">{{ subject.room }} / {{ subject.teacher }}</p>

          {% for block in today_todos %}
            {% if block.class_name == subject.class_name %}
              <ul class="list-group list-group-flush">
                {% for task in block.tasks %}
                  <li class="list-group-item d-flex justify-content-between align-items-start">
                    <div>
                      {% if task.done %}
                        âœ… <s>{{ task.task }}</s>
                      {% else %}
                        {{ task.task }}
                      {% endif %}
                      {% if task.due_date %}
                        <br><small class="text-muted">
                          {% if task.days_left > 0 %}
                            <span class="badge bg-secondary">ã‚ã¨{{ task.days_left }}æ—¥</span>
                          {% elif task.days_left == 0 %}
                            <span class="badge bg-warning text-dark">ä»Šæ—¥ãŒç· åˆ‡ï¼</span>
                          {% else %}
                            <span class="badge bg-danger">æœŸé™åˆ‡ã‚Œï¼ˆ{{ task.days_left | abs }}æ—¥å‰ï¼‰</span>
                          {% endif %}
                        </small>
                      {% endif %}
                    </div>
                    <div class="ms-2">
                      <a href="{{ url_for('mark_done', index=loop.index0) }}" class="btn btn-sm btn-outline-success">{% if task.done %}æˆ»ã™{% else %}å®Œäº†{% endif %}</a>
                      <a href="{{ url_for('delete_todo', index=loop.index0) }}" class="btn btn-sm btn-outline-danger">å‰Šé™¤</a>
                    </div>
                  </li>
                {% endfor %}
              </ul>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p class="text-muted">ä»Šæ—¥ã®æˆæ¥­ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
  {% endif %}

  <h4 class="mt-5">ğŸ“‹ ã‚„ã‚‹ã“ã¨ãƒªã‚¹ãƒˆï¼ˆå…¨ä½“ï¼‰</h4>
  <ul class="list-group">
    {% for todo in todos %}
      <li class="list-group-item d-flex justify-content-between align-items-start">
        <div>
          {% if todo.done %}
            âœ… <s>{{ todo.task }}</s>
          {% else %}
            {{ todo.task }}
          {% endif %}
          {% if todo.class_name %}
            <span class="text-muted">ï¼ˆ{{ todo.class_name }}ï¼‰</span>
          {% endif %}
          {% if todo.due_date %}
            <br><small>
              {% if todo.days_left > 0 %}
                <span class="badge bg-secondary">ã‚ã¨{{ todo.days_left }}æ—¥</span>
              {% elif todo.days_left == 0 %}
                <span class="badge bg-warning text-dark">ä»Šæ—¥ãŒç· åˆ‡ï¼</span>
              {% else %}
                <span class="badge bg-danger">æœŸé™åˆ‡ã‚Œï¼ˆ{{ todo.days_left | abs }}æ—¥å‰ï¼‰</span>
              {% endif %}
            </small>
          {% endif %}
        </div>
        <div class="ms-2">
          <a href="{{ url_for('mark_done', index=loop.index0) }}" class="btn btn-sm btn-outline-success">{% if todo.done %}æˆ»ã™{% else %}å®Œäº†{% endif %}</a>
          <a href="{{ url_for('delete_todo', index=loop.index0) }}" class="btn btn-sm btn-outline-danger">å‰Šé™¤</a>
        </div>
      </li>
    {% endfor %}
  </ul>

  <hr class="mt-5">
  <div class="d-flex justify-content-between">
    <a href="{{ url_for('schedule_page') }}" class="btn btn-outline-primary">ğŸ“… æ™‚é–“å‰²ã‚’ç™»éŒ²</a>
    <a href="{{ url_for('grades_page') }}" class="btn btn-outline-primary">ğŸ“Š æˆç¸¾ã‚’ç¢ºèª</a>
  </div>
</div>
{% endblock %}
